/* Generated by Nimrod Compiler v0.9.3 */
/*   (c) 2012 Andreas Rumpf */
/* The generated code is subject to the original license. */
/* Compiled for: MacOSX, amd64, gcc */
/* Command for C compiler:
   gcc -c  -w -O3 -fno-strict-aliasing  -I/usr/src/extras/Nimrod/lib -o compiler/nimcache/ropes.o compiler/nimcache/ropes.c */
#define NIM_INTBITS 64
#include "nimbase.h"

#include <string.h>

#include <stdio.h>
typedef struct NimStringDesc NimStringDesc;
typedef struct TGenericSeq TGenericSeq;
typedef struct trope126007 trope126007;
typedef struct TNimObject TNimObject;
typedef struct TNimType TNimType;
typedef struct TNimNode TNimNode;
typedef struct tcell38449 tcell38449;
typedef struct tcellseq38465 tcellseq38465;
typedef struct tgcheap40416 tgcheap40416;
typedef struct tcellset38461 tcellset38461;
typedef struct tpagedesc38457 tpagedesc38457;
typedef struct tmemregion22010 tmemregion22010;
typedef struct tsmallchunk21243 tsmallchunk21243;
typedef struct tllchunk22004 tllchunk22004;
typedef struct tbigchunk21245 tbigchunk21245;
typedef struct tintset21218 tintset21218;
typedef struct ttrunk21214 ttrunk21214;
typedef struct tavlnode22008 tavlnode22008;
typedef struct tgcstat40414 tgcstat40414;
typedef struct TY128316 TY128316;
typedef struct tbasechunk21241 tbasechunk21241;
typedef struct tfreecell21233 tfreecell21233;
struct TGenericSeq {
NI len;
NI reserved;
};
typedef NIM_CHAR TY611[100000001];
struct NimStringDesc {
  TGenericSeq Sup;
TY611 data;
};
typedef struct {
N_NIMCALL_PTR(void, ClPrc) (NU8 err, NimStringDesc* msg, NIM_BOOL usewarning, void* ClEnv);
void* ClEnv;
} TY126103;
typedef trope126007* TY126176[4096];
typedef N_NIMCALL_PTR(void, TY891) (void* p, NI op);
struct TNimType {
NI size;
NU8 kind;
NU8 flags;
TNimType* base;
TNimNode* node;
void* finalizer;
TY891 marker;
};
struct TNimObject {
TNimType* m_type;
};
struct trope126007 {
  TNimObject Sup;
trope126007* Left;
trope126007* Right;
NI Length;
NimStringDesc* Data;
};
struct TNimNode {
NU8 kind;
NI offset;
TNimType* typ;
NCSTRING name;
NI len;
TNimNode** sons;
};
struct tcell38449 {
NI Refcount;
TNimType* Typ;
};
struct tcellseq38465 {
NI Len;
NI Cap;
tcell38449** D;
};
struct tcellset38461 {
NI Counter;
NI Max;
tpagedesc38457* Head;
tpagedesc38457** Data;
};
typedef tsmallchunk21243* TY22022[512];
typedef ttrunk21214* ttrunkbuckets21216[256];
struct tintset21218 {
ttrunkbuckets21216 Data;
};
struct tmemregion22010 {
NI Minlargeobj;
NI Maxlargeobj;
TY22022 Freesmallchunks;
tllchunk22004* Llmem;
NI Currmem;
NI Maxmem;
NI Freemem;
NI Lastsize;
tbigchunk21245* Freechunkslist;
tintset21218 Chunkstarts;
tavlnode22008* Root;
tavlnode22008* Deleted;
tavlnode22008* Last;
tavlnode22008* Freeavlnodes;
};
struct tgcstat40414 {
NI Stackscans;
NI Cyclecollections;
NI Maxthreshold;
NI Maxstacksize;
NI Maxstackcells;
NI Cycletablesize;
NI64 Maxpause;
};
struct tgcheap40416 {
void* Stackbottom;
NI Cyclethreshold;
tcellseq38465 Zct;
tcellseq38465 Decstack;
tcellset38461 Cycleroots;
tcellseq38465 Tempstack;
NI Recgclock;
tmemregion22010 Region;
tgcstat40414 Stat;
};
typedef trope126007* TY126482[1];
typedef N_CLOSURE_PTR(void, TMP2915) (NU8 err, NimStringDesc* msg, NIM_BOOL usewarning);
typedef N_CLOSURE_PTR(void, TMP2916) (NU8 err, NimStringDesc* msg, NIM_BOOL usewarning);
typedef N_CLOSURE_PTR(void, TMP3588) (NU8 err, NimStringDesc* msg, NIM_BOOL usewarning);
typedef NI TY124044[256];
typedef NI TY21221[8];
struct tpagedesc38457 {
tpagedesc38457* Next;
NI Key;
TY21221 Bits;
};
struct tbasechunk21241 {
NI Prevsize;
NI Size;
NIM_BOOL Used;
};
struct tsmallchunk21243 {
  tbasechunk21241 Sup;
tsmallchunk21243* Next;
tsmallchunk21243* Prev;
tfreecell21233* Freelist;
NI Free;
NI Acc;
NF64 Data;
};
struct tllchunk22004 {
NI Size;
NI Acc;
tllchunk22004* Next;
};
struct tbigchunk21245 {
  tbasechunk21241 Sup;
tbigchunk21245* Next;
tbigchunk21245* Prev;
NI Align;
NF64 Data;
};
struct ttrunk21214 {
ttrunk21214* Next;
NI Key;
TY21221 Bits;
};
typedef tavlnode22008* TY22014[2];
struct tavlnode22008 {
TY22014 Link;
NI Key;
NI Upperbound;
NI Level;
};
struct tfreecell21233 {
tfreecell21233* Next;
NI Zerofield;
};
struct TY128316 {
  TGenericSeq Sup;
  trope126007* data[SEQ_DECL_SIZE];
};
N_NIMCALL(trope126007*, newrope_126129)(NimStringDesc* data);
N_NIMCALL(void, nimGCvisit)(void* d, NI op);
N_NIMCALL(void, TMP117)(void* p, NI op);
N_NIMCALL(void*, newObj)(TNimType* typ, NI size);
N_NIMCALL(NimStringDesc*, copyStringRC1)(NimStringDesc* src);
static N_INLINE(void, nimGCunrefNoCycle)(void* p);
static N_INLINE(tcell38449*, usrtocell_41843)(void* usr);
static N_INLINE(void, rtladdzct_43002)(tcell38449* c);
N_NOINLINE(void, addzct_41815)(tcellseq38465* s, tcell38449* c);
static N_INLINE(void, asgnRefNoCycle)(void** dest, void* src);
N_NIMCALL(trope126007*, con_126020)(trope126007* a, trope126007* b);
N_NIMCALL(void, unsureAsgnRef)(void** dest, void* src);
N_NIMCALL(trope126007*, insertincache_126245)(NimStringDesc* s);
N_NIMCALL(NI, hash_101825)(NimStringDesc* x);
static N_INLINE(NIM_BOOL, eqStrings)(NimStringDesc* a, NimStringDesc* b);
N_NIMCALL(NimStringDesc*, copyString)(NimStringDesc* src);
N_NIMCALL(NimStringDesc*, mnewString)(NI len);
N_NIMCALL(NimStringDesc*, mnewString)(NI len);
N_NIMCALL(void, newrecropetostr_126460)(NimStringDesc** result, NI* resultlen, trope126007* r);
N_NIMCALL(void*, newSeq)(TNimType* typ, NI len);
N_NIMCALL(TGenericSeq*, incrSeq)(TGenericSeq* seq, NI elemsize);
N_NIMCALL(trope126007*, con_126025)(trope126007* a, NimStringDesc* b);
N_NIMCALL(trope126007*, torope_126058)(NimStringDesc* s);
N_NIMCALL(NimStringDesc*, nimInt64ToStr)(NI64 x);
N_NIMCALL(void, app_126040)(trope126007** a, trope126007* b);
N_NIMCALL(trope126007*, ropef_126079)(NimStringDesc* frmt, trope126007** args, NI argslen0);
N_NIMCALL(void, app_126046)(trope126007** a, NimStringDesc* b);
N_NIMCALL(NimStringDesc*, nimIntToStr)(NI x);
N_NIMCALL(NimStringDesc*, nimCharToStr)(NIM_CHAR x);
N_NIMCALL(NimStringDesc*, copyStrLast)(NimStringDesc* s, NI start_63424, NI last);
N_NIMCALL(NimStringDesc*, copyStrLast)(NimStringDesc* s, NI first, NI last);
N_NIMCALL(NIM_BOOL, open_8817)(FILE** f, NimStringDesc* filename, NU8 mode, NI bufsize);
N_NIMCALL(void, writerope_126963)(FILE* f, trope126007* c);
N_NIMCALL(void, write_9062)(FILE* f, NimStringDesc* s);
N_NIMCALL(NI32, crcfromfile_124029)(NimStringDesc* filename);
N_NIMCALL(NI32, crcfromrope_127823)(trope126007* r);
N_NIMCALL(NI32, newcrcfromropeaux_127677)(trope126007* r, NI32 startval);
static N_INLINE(NI32, updatecrc32_124015)(NIM_CHAR val, NI32 crc);
static N_INLINE(NI32, updatecrc32_124010)(NI8 val, NI32 crc);
N_NIMCALL(void, writerope_127407)(trope126007* head, NimStringDesc* filename, NIM_BOOL usewarning);
static N_INLINE(trope126007*, pop_126500)(TY128316** s);
N_NIMCALL(TGenericSeq*, setLengthSeq)(TGenericSeq* seq, NI elemsize, NI newlen);
STRING_LITERAL(TMP1082, "", 0);
STRING_LITERAL(TMP2914, "$", 1);
extern NIM_CONST TY124044 crc32table_124043;
TY126103 errorhandler_126108;
TY126176 cache_126184;
NI gcachetries_126239;
NI gcachemisses_126241;
NI gcacheinttries_126243;
trope126007* rnl_127428;
extern TNimType NTI1009; /* TObject */
TNimType NTI126007; /* TRope */
extern TNimType NTI105; /* int */
extern TNimType NTI143; /* string */
TNimType NTI126005; /* PRope */
extern tgcheap40416 gch_40442;
extern NimStringDesc* tnl_123580;
trope126007* softrnl_127429;
extern TNimType NTI128316; /* seq[PRope] */
N_NIMCALL(void, TMP117)(void* p, NI op) {
	trope126007* a;
	a = (trope126007*)p;
	nimGCvisit((void*)(*a).Left, op);
	nimGCvisit((void*)(*a).Right, op);
	nimGCvisit((void*)(*a).Data, op);
}

static N_INLINE(tcell38449*, usrtocell_41843)(void* usr) {
	tcell38449* result;
	result = 0;
	result = ((tcell38449*) ((NI)((NU64)(((NI) (usr))) - (NU64)(((NI)sizeof(tcell38449))))));
	return result;
}

static N_INLINE(void, rtladdzct_43002)(tcell38449* c) {
	addzct_41815(&gch_40442.Zct, c);
}

static N_INLINE(void, nimGCunrefNoCycle)(void* p) {
	tcell38449* c;
	c = usrtocell_41843(p);
	{
		(*c).Refcount -= 8;
		if (!((NU64)((*c).Refcount) < (NU64)(8))) goto LA3;
		rtladdzct_43002(c);
	}
	LA3: ;
}

N_NIMCALL(trope126007*, newrope_126129)(NimStringDesc* data) {
	trope126007* result;
	result = 0;
	result = (trope126007*) newObj((&NTI126005), sizeof(trope126007));
	(*result).Sup.m_type = (&NTI126007);
	{
		NimStringDesc* LOC5;
		if (!!((data == NIM_NIL))) goto LA3;
		(*result).Length = data->Sup.len;
		LOC5 = 0;
		LOC5 = (*result).Data; (*result).Data = copyStringRC1(data);
		if (LOC5) nimGCunrefNoCycle(LOC5);
	}
	LA3: ;
	return result;
}

static N_INLINE(void, asgnRefNoCycle)(void** dest, void* src) {
	{
		tcell38449* c;
		if (!!((src == NIM_NIL))) goto LA3;
		c = usrtocell_41843(src);
		(*c).Refcount += 8;
	}
	LA3: ;
	{
		tcell38449* c;
		if (!!(((*dest) == NIM_NIL))) goto LA7;
		c = usrtocell_41843((*dest));
		{
			(*c).Refcount -= 8;
			if (!((NU64)((*c).Refcount) < (NU64)(8))) goto LA11;
			rtladdzct_43002(c);
		}
		LA11: ;
	}
	LA7: ;
	(*dest) = src;
}

N_NIMCALL(trope126007*, con_126020)(trope126007* a, trope126007* b) {
	trope126007* result;
	result = 0;
	{
		if (!(a == NIM_NIL)) goto LA3;
		result = b;
	}
	goto LA1;
	LA3: ;
	{
		if (!(b == NIM_NIL)) goto LA6;
		result = a;
	}
	goto LA1;
	LA6: ;
	{
		result = newrope_126129(NIM_NIL);
		(*result).Length = (NI64)((*a).Length + (*b).Length);
		asgnRefNoCycle((void**) &(*result).Left, a);
		asgnRefNoCycle((void**) &(*result).Right, b);
	}
	LA1: ;
	return result;
}

N_NIMCALL(void, app_126040)(trope126007** a, trope126007* b) {
	unsureAsgnRef((void**) &(*a), con_126020((*a), b));
}

static N_INLINE(NIM_BOOL, eqStrings)(NimStringDesc* a, NimStringDesc* b) {
	NIM_BOOL result;
	NIM_BOOL LOC11;
	int LOC13;
	result = 0;
	{
		if (!(a == b)) goto LA3;
		result = NIM_TRUE;
		goto BeforeRet;
	}
	LA3: ;
	{
		NIM_BOOL LOC7;
		LOC7 = (a == NIM_NIL);
		if (LOC7) goto LA8;
		LOC7 = (b == NIM_NIL);
		LA8: ;
		if (!LOC7) goto LA9;
		result = NIM_FALSE;
		goto BeforeRet;
	}
	LA9: ;
	LOC11 = ((*a).Sup.len == (*b).Sup.len);
	if (!(LOC11)) goto LA12;
	LOC13 = memcmp(((NCSTRING) ((*a).data)), ((NCSTRING) ((*b).data)), (NI64)((*a).Sup.len * 1));
	LOC11 = (LOC13 == ((NI32) 0));
	LA12: ;
	result = LOC11;
	goto BeforeRet;
	BeforeRet: ;
	return result;
}

N_NIMCALL(trope126007*, insertincache_126245)(NimStringDesc* s) {
	trope126007* result;
	NI h;
	NI LOC1;
	result = 0;
	gcachetries_126239 += 1;
	LOC1 = hash_101825(s);
	h = (NI)(LOC1 & 4095);
	result = cache_126184[(h)- 0];
	{
		NIM_BOOL LOC4;
		LOC4 = result == 0;
		if (LOC4) goto LA5;
		LOC4 = !(eqStrings((*result).Data, s));
		LA5: ;
		if (!LOC4) goto LA6;
		gcachemisses_126241 += 1;
		result = newrope_126129(s);
		asgnRefNoCycle((void**) &cache_126184[(h)- 0], result);
	}
	LA6: ;
	return result;
}

N_NIMCALL(trope126007*, torope_126058)(NimStringDesc* s) {
	trope126007* result;
	result = 0;
	{
		if (!(s->Sup.len == 0)) goto LA3;
		result = NIM_NIL;
	}
	goto LA1;
	LA3: ;
	{
		result = insertincache_126245(s);
	}
	LA1: ;
	return result;
}

N_NIMCALL(void, newrecropetostr_126460)(NimStringDesc** result, NI* resultlen, trope126007* r) {
	TY128316* stack;
	TY126482 LOC1;
	stack = (TY128316*) newSeq((&NTI128316), 1);
	memset((void*)LOC1, 0, sizeof(LOC1));
	LOC1[0] = r;
	asgnRefNoCycle((void**) &stack->data[0], LOC1[0]);
	while (1) {
		trope126007* it;
		if (!(0 < stack->Sup.len)) goto LA2;
		it = pop_126500(&stack);
		while (1) {
			if (!((*it).Data == NIM_NIL)) goto LA3;
			stack = (TY128316*) incrSeq(&(stack)->Sup, sizeof(trope126007*));
			asgnRefNoCycle((void**) &stack->data[stack->Sup.len-1], (*it).Right);
			it = (*it).Left;
		} LA3: ;
		memcpy(((void*) (&(*result)->data[(*resultlen)])), ((void*) (&(*it).Data->data[0])), (*it).Length);
		(*resultlen) += (*it).Length;
	} LA2: ;
}

N_NIMCALL(NimStringDesc*, ropetostr_126075)(trope126007* p) {
	NimStringDesc* result;
	result = 0;
	{
		if (!(p == NIM_NIL)) goto LA3;
		result = copyString(((NimStringDesc*) &TMP1082));
	}
	goto LA1;
	LA3: ;
	{
		NI resultlen;
		result = mnewString((*p).Length);
		resultlen = 0;
		newrecropetostr_126460(&result, &resultlen, p);
	}
	LA1: ;
	return result;
}

N_NIMCALL(trope126007*, con_126025)(trope126007* a, NimStringDesc* b) {
	trope126007* result;
	trope126007* LOC1;
	result = 0;
	LOC1 = 0;
	LOC1 = torope_126058(b);
	result = con_126020(a, LOC1);
	return result;
}

N_NIMCALL(void, app_126046)(trope126007** a, NimStringDesc* b) {
	unsureAsgnRef((void**) &(*a), con_126025((*a), b));
}

N_NIMCALL(trope126007*, torope_126062)(NI64 i) {
	trope126007* result;
	NimStringDesc* LOC1;
	result = 0;
	gcacheinttries_126243 += 1;
	LOC1 = 0;
	LOC1 = nimInt64ToStr(i);
	result = torope_126058(LOC1);
	return result;
}

N_NIMCALL(trope126007*, con_126035)(trope126007** a, NI alen0) {
	trope126007* result;
	NI i_126885;
	NI HEX3Atmp_126888;
	NI res_126890;
	result = 0;
	i_126885 = 0;
	HEX3Atmp_126888 = 0;
	HEX3Atmp_126888 = (alen0-1);
	res_126890 = 0;
	while (1) {
		if (!(res_126890 <= HEX3Atmp_126888)) goto LA1;
		i_126885 = res_126890;
		result = con_126020(result, a[i_126885]);
		res_126890 += 1;
	} LA1: ;
	return result;
}

N_NIMCALL(trope126007*, ropef_126079)(NimStringDesc* frmt, trope126007** args, NI argslen0) {
	trope126007* result;
	NI i;
	NI length;
	NI num;
	result = 0;
	i = 0;
	length = frmt->Sup.len;
	result = NIM_NIL;
	num = 0;
	while (1) {
		NI start;
		if (!(i <= (NI64)(length - 1))) goto LA1;
		{
			if (!((NU8)(frmt->data[i]) == (NU8)(36))) goto LA4;
			i += 1;
			switch (((NU8)(frmt->data[i]))) {
			case 36:
			{
				app_126046(&result, ((NimStringDesc*) &TMP2914));
				i += 1;
			}
			break;
			case 35:
			{
				i += 1;
				app_126040(&result, args[num]);
				num += 1;
			}
			break;
			case 48 ... 57:
			{
				NI j;
				j = 0;
				while (1) {
					j = (NI64)((NI64)((NI64)(j * 10) + ((NI) (((NU8)(frmt->data[i]))))) - 48);
					i += 1;
					{
						NIM_BOOL LOC12;
						LOC12 = ((NI64)((NI64)(length + 0) - 1) < i);
						if (LOC12) goto LA13;
						LOC12 = !((((NU8)(frmt->data[i])) >= ((NU8)(48)) && ((NU8)(frmt->data[i])) <= ((NU8)(57))));
						LA13: ;
						if (!LOC12) goto LA14;
						goto LA9;
					}
					LA14: ;
				} LA9: ;
				num = j;
				{
					NimStringDesc* LOC20;
					if (!((NI64)((argslen0-1) + 1) < j)) goto LA18;
					LOC20 = 0;
					LOC20 = nimIntToStr(j);
					errorhandler_126108.ClEnv? errorhandler_126108.ClPrc(((NU8) 1), LOC20, NIM_FALSE, errorhandler_126108.ClEnv) : ((TMP2915)(errorhandler_126108.ClPrc))(((NU8) 1), LOC20, NIM_FALSE);
				}
				goto LA16;
				LA18: ;
				{
					app_126040(&result, args[(NI64)(j - 1)]);
				}
				LA16: ;
			}
			break;
			case 110:
			{
				app_126040(&result, softrnl_127429);
				i += 1;
			}
			break;
			case 78:
			{
				app_126040(&result, rnl_127428);
				i += 1;
			}
			break;
			default:
			{
				NimStringDesc* LOC25;
				LOC25 = 0;
				LOC25 = nimCharToStr(frmt->data[i]);
				errorhandler_126108.ClEnv? errorhandler_126108.ClPrc(((NU8) 1), LOC25, NIM_FALSE, errorhandler_126108.ClEnv) : ((TMP2916)(errorhandler_126108.ClPrc))(((NU8) 1), LOC25, NIM_FALSE);
			}
			break;
			}
		}
		LA4: ;
		start = i;
		while (1) {
			if (!(i < length)) goto LA26;
			{
				if (!!(((NU8)(frmt->data[i]) == (NU8)(36)))) goto LA29;
				i += 1;
			}
			goto LA27;
			LA29: ;
			{
				goto LA26;
			}
			LA27: ;
		} LA26: ;
		{
			NimStringDesc* LOC36;
			if (!(start <= (NI64)(i - 1))) goto LA34;
			LOC36 = 0;
			LOC36 = copyStrLast(frmt, start, (NI64)(i - 1));
			app_126046(&result, LOC36);
		}
		LA34: ;
	} LA1: ;
	return result;
}

N_NIMCALL(void, appf_126085)(trope126007** c, NimStringDesc* frmt, trope126007** args, NI argslen0) {
	trope126007* LOC1;
	LOC1 = 0;
	LOC1 = ropef_126079(frmt, args, argslen0);
	app_126040(c, LOC1);
}

N_NIMCALL(trope126007*, con_126030)(NimStringDesc* a, trope126007* b) {
	trope126007* result;
	trope126007* LOC1;
	result = 0;
	LOC1 = 0;
	LOC1 = torope_126058(a);
	result = con_126020(LOC1, b);
	return result;
}

N_NIMCALL(void, prepend_126052)(trope126007** a, trope126007* b) {
	unsureAsgnRef((void**) &(*a), con_126020(b, (*a)));
}

N_NIMCALL(void, writerope_126963)(FILE* f, trope126007* c) {
	TY128316* stack;
	TY126482 LOC1;
	stack = (TY128316*) newSeq((&NTI128316), 1);
	memset((void*)LOC1, 0, sizeof(LOC1));
	LOC1[0] = c;
	asgnRefNoCycle((void**) &stack->data[0], LOC1[0]);
	while (1) {
		trope126007* it;
		if (!(0 < stack->Sup.len)) goto LA2;
		it = pop_126500(&stack);
		while (1) {
			if (!((*it).Data == NIM_NIL)) goto LA3;
			stack = (TY128316*) incrSeq(&(stack)->Sup, sizeof(trope126007*));
			asgnRefNoCycle((void**) &stack->data[stack->Sup.len-1], (*it).Right);
			it = (*it).Left;
		} LA3: ;
		write_9062(f, (*it).Data);
	} LA2: ;
}

N_NIMCALL(void, writerope_127407)(trope126007* head, NimStringDesc* filename, NIM_BOOL usewarning) {
	FILE* f;
	f = 0;
	{
		NIM_BOOL LOC3;
		LOC3 = open_8817(&f, filename, ((NU8) 1), -1);
		if (!LOC3) goto LA4;
		{
			if (!!((head == NIM_NIL))) goto LA8;
			writerope_126963(f, head);
		}
		LA8: ;
		fclose(f);
	}
	goto LA1;
	LA4: ;
	{
		errorhandler_126108.ClEnv? errorhandler_126108.ClPrc(((NU8) 0), filename, usewarning, errorhandler_126108.ClEnv) : ((TMP3588)(errorhandler_126108.ClPrc))(((NU8) 0), filename, usewarning);
	}
	LA1: ;
}

static N_INLINE(NI32, updatecrc32_124010)(NI8 val, NI32 crc) {
	NI32 result;
	result = 0;
	result = (NI32)(((NI32) (crc32table_124043[((NI)((NI)(((NI) (crc)) ^ ((NI) ((NI)(((NI) (val)) & 255)))) & 255))- 0])) ^ (NI32)((NU32)(crc) >> (NU32)(((NI32) 8))));
	return result;
}

static N_INLINE(NI32, updatecrc32_124015)(NIM_CHAR val, NI32 crc) {
	NI32 result;
	result = 0;
	result = updatecrc32_124010(((NI8)(NU8)(NU)(((NI) (((NU8)(val)))))), crc);
	return result;
}

N_NIMCALL(NI32, newcrcfromropeaux_127677)(trope126007* r, NI32 startval) {
	NI32 result;
	TY128316* stack;
	TY126482 LOC1;
	result = 0;
	stack = (TY128316*) newSeq((&NTI128316), 1);
	memset((void*)LOC1, 0, sizeof(LOC1));
	LOC1[0] = r;
	asgnRefNoCycle((void**) &stack->data[0], LOC1[0]);
	result = startval;
	while (1) {
		trope126007* it;
		NI i;
		NI l;
		if (!(0 < stack->Sup.len)) goto LA2;
		it = pop_126500(&stack);
		while (1) {
			if (!((*it).Data == NIM_NIL)) goto LA3;
			stack = (TY128316*) incrSeq(&(stack)->Sup, sizeof(trope126007*));
			asgnRefNoCycle((void**) &stack->data[stack->Sup.len-1], (*it).Right);
			it = (*it).Left;
		} LA3: ;
		i = 0;
		l = (*it).Data->Sup.len;
		while (1) {
			if (!(i < l)) goto LA4;
			result = updatecrc32_124015((*it).Data->data[i], result);
			i += 1;
		} LA4: ;
	} LA2: ;
	return result;
}

N_NIMCALL(NI32, crcfromrope_127823)(trope126007* r) {
	NI32 result;
	result = 0;
	result = newcrcfromropeaux_127677(r, ((NI32) -1));
	return result;
}

N_NIMCALL(NIM_BOOL, writeropeifnotequal_126070)(trope126007* r, NimStringDesc* filename) {
	NIM_BOOL result;
	NI32 c;
	result = 0;
	c = 0;
	c = crcfromfile_124029(filename);
	{
		NI32 LOC3;
		LOC3 = crcfromrope_127823(r);
		if (!!((c == LOC3))) goto LA4;
		writerope_127407(r, filename, NIM_FALSE);
		result = NIM_TRUE;
	}
	goto LA1;
	LA4: ;
	{
		result = NIM_FALSE;
	}
	LA1: ;
	return result;
}

N_NIMCALL(void, resetropecache_126187)(void) {
	NI i_126213;
	NI res_126217;
	i_126213 = 0;
	res_126217 = 0;
	while (1) {
		if (!(((NI) (res_126217)) <= 4095)) goto LA1;
		i_126213 = res_126217;
		asgnRefNoCycle((void**) &cache_126184[(i_126213)- 0], NIM_NIL);
		res_126217 += 1;
	} LA1: ;
}

static N_INLINE(trope126007*, pop_126500)(TY128316** s) {
	trope126007* result;
	NI l;
	result = 0;
	l = (NI64)((*s)->Sup.len - 1);
	result = (*s)->data[l];
	(*s) = (TY128316*) setLengthSeq(&((*s))->Sup, sizeof(trope126007*), l);
	return result;
}
N_NOINLINE(void, ropesInit)(void) {
	gcachetries_126239 = 0;
	gcachemisses_126241 = 0;
	gcacheinttries_126243 = 0;
	asgnRefNoCycle((void**) &rnl_127428, newrope_126129(tnl_123580));
	asgnRefNoCycle((void**) &softrnl_127429, newrope_126129(tnl_123580));
}

N_NOINLINE(void, ropesDatInit)(void) {
static TNimNode* TMP116[4];
static TNimNode TMP47[5];
NTI126007.size = sizeof(trope126007);
NTI126007.kind = 17;
NTI126007.base = (&NTI1009);
NTI126007.flags = 2;
TMP116[0] = &TMP47[1];
TMP47[1].kind = 1;
TMP47[1].offset = offsetof(trope126007, Left);
TMP47[1].typ = (&NTI126005);
TMP47[1].name = "left";
TMP116[1] = &TMP47[2];
TMP47[2].kind = 1;
TMP47[2].offset = offsetof(trope126007, Right);
TMP47[2].typ = (&NTI126005);
TMP47[2].name = "right";
TMP116[2] = &TMP47[3];
TMP47[3].kind = 1;
TMP47[3].offset = offsetof(trope126007, Length);
TMP47[3].typ = (&NTI105);
TMP47[3].name = "length";
TMP116[3] = &TMP47[4];
TMP47[4].kind = 1;
TMP47[4].offset = offsetof(trope126007, Data);
TMP47[4].typ = (&NTI143);
TMP47[4].name = "data";
TMP47[0].len = 4; TMP47[0].kind = 2; TMP47[0].sons = &TMP116[0];
NTI126007.node = &TMP47[0];
NTI126005.size = sizeof(trope126007*);
NTI126005.kind = 22;
NTI126005.base = (&NTI126007);
NTI126005.flags = 2;
NTI126005.marker = TMP117;
}

